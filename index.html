<!DOCTYPE html>
<html lang="en">

<!-- Made by Thomas - thomasprice.me -->
<!-- Please don't use inspect element to cheat or find soltions to puzzles! It's all possible and mostly easy :) -->

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spooky Boba Submission</title>
  <link rel="stylesheet" href="style.css">

  <!-- tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- fa icons -->
  <script src="https://kit.fontawesome.com/8bed0ad5bd.js" crossorigin="anonymous"></script>
</head>

<body class="bg-black">
  <div class="fixed top-4 w-screen flex justify-between flex-col md:flex-row-reverse px-4 z-50">
    <div class="flex flex-col items-end px-4">
      <div class="flex items-center">
        <div class="">
          <a onclick="document.getElementById('exit-modal').classList.remove('invisible')"
            class="bg-black border-4 border-white text-white rounded-md px-4 py-2 font-semibold capitalize relative top-0 hover:top-[2px] transition-all cursor-pointer">
            Escape
          </a>
        </div>
  
        <a href="https://github.com/ThomasJPrice/boba-manor-submission"
          class="bg-black border-4 ml-2 border-white text-white rounded-md px-2 py-1 relative top-0 hover:top-[2px] transition-all"
          target="_blank">
          <i class="fa-brands fa-github text-xl"></i>
        </a>
      </div>

      <a href="https://manor.hackclub.com" class="mt-2 text-right text-white font-semibold">Open the Door </br >(manor.hackclub.com)</a>
    </div>

    <div class="text-white font-semibold mt-2 md:mt-0">
      <ul class="text-left text-white max-w-[200px] list-disc"></ul>
      <li>Made for Hack Club Boba Manor</li>
      <li>Best Playable on Desktop</li>
      </ul>
    </div>
  </div>


  <!-- main game container -->
  <div
    class="w-[1080px] min-h-screen max-lg:overflow-x-scroll overflow-y-hidden mx-auto relative grid place-items-center bg-bottom bg-cover"
    id="gameContainer">

    <!-- inventory -->
    <div class="absolute bottom-8 left-8 z-[100] flex" id="inventory">
    </div>

    <!-- jumpscares -->
    <!-- skull -->
    <div class="absolute left-[580px] top-[328px] cursor-pointer" id="jumpscares-skull">
      <img src="./assets/skull.png" alt="shhhh... not telling you!" class="w-[40px] p-2 hover:scale-[1.1]">
    </div>

    <div class="absolute left-[722px] top-[239px] pointer-events-none invisible" id="jumpscares-ghoul">
      <img src="./assets/ghoul.png" alt="shhhh... not telling you!" class="pointer-events-none">
    </div>

    <!-- first puzzle - cabinet -->
    <!-- lock -->
    <div onclick="handleLockClick()" class="absolute left-[870px] top-[560px] cursor-pointer" id="puzzle1-padlock">
      <img class="w-[35px] p-2 hover:scale-[1.1]" src="./assets/padlock.png" alt="shhhh... it's a padlock!">
    </div>

    <!-- paper -->
    <div class="absolute cursor-pointer top-[680px]" id="puzzle1-paper">
      <img src="./assets/puzzle1.png" alt="shhhh... it's a puzzle" class="w-[40px] p-2 hover:scale-[1.1]">
    </div>

    <!-- paper modal -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full px-8 max-w-[600px] z-[100] invisible"
      id="puzzle1-modal">
      <button class="text-white absolute top-0 right-0 text-2xl bg-black px-2 py-1 border-4 rounded-md"
        onclick="document.getElementById('puzzle1-modal').classList.add('invisible'); document.getElementById('puzzle1-paper').classList.remove('invisible')">
        <i class="fa-solid fa-xmark"></i>
      </button>

      <img src="./assets/puzzle1.png" alt="puzzle 1" class="w-full p-4">

      <!-- inputs -->
      <div class="flex justify-between mt-4">
        <p class="bg-black border-4 rounded-md text-white font-semibold px-2 py-1">Reward: ðŸ”‘</p>

        <div class="flex">
          <input class="bg-black px-2 py-1 text-white border-4 rounded-l-md" type="text" name="puzzle1"
            id="puzzle1-input" placeholder="Answer">
          <button type="submit" class="bg-black text-white border-4 border-l-0 rounded-r-md py-1 px-2 font-semibold"
            onclick="handlePuzzle1Submit()">Submit</button>
        </div>
      </div>
    </div>


    <!-- second puzzle - console -->
    <div id="puzzle2-trigger" class="absolute left-[170px] top-[370px] cursor-pointer invisible"
      onclick="document.getElementById('puzzle2-modal').classList.remove('invisible'); document.getElementById('puzzle2-trigger').classList.add('invisible')">
      <img src="./assets/console.png" alt="shhhh... it's a games console!" class="p-2 hover:scale-[1.1] w-[60px]">
    </div>

    <!-- console modal -->
    <div id="puzzle2-modal"
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full px-8 max-w-[800px] z-[100] invisible">
      <button class="text-white absolute top-0 right-0 text-2xl bg-black px-2 py-1 border-4 rounded-md"
        onclick="document.getElementById('puzzle2-modal').classList.add('invisible'); document.getElementById('puzzle2-trigger').classList.remove('invisible')">
        <i class="fa-solid fa-xmark"></i>
      </button>

      <div class="px-4 w-full">
        <div id="puzzle2-success" class="h-[270px] w-[462px] absolute top-[44px] left-[170px] invisible">
          <img src="./assets/scrap2.png" alt="the number 3"
            class="absolute z-[100] w-[200px] top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
          <img src="./assets/matrix.gif" alt="matrix raining code"
            class="h-full w-full object-cover object-top pointer-events-none">
        </div>


        <div id="puzzle2-glitch" class="invisible h-[270px] w-[462px] absolute top-[44px] left-[170px]">
          <img src="./assets/glitch-font.png" alt="Try again"
            class="absolute z-[100] w-[300px] top-1/2 left-1/2 -translate-x-1/2 -translate-y-[70%] pointer-events-none">
          <img src="./assets/glitch.gif" alt="glitch" class="h-full w-full object-cover object-top pointer-events-none">
        </div>

        <canvas id="console-canvas" class="" width="704" height="371"></canvas>
      </div>
    </div>




    <!-- third puzzle - radio -->
    <!-- radio -->
    <div class="absolute left-[900px] top-[475px] cursor-pointer" id="puzzle3-radio">
      <img class="w-[60px] p-2 hover:scale-[1.1]" src="./assets/radio.png" alt="shhhh... it's a radio!">
    </div>


    <!-- thank you modal -->
    <div id="thank-you" class="bg-black transition-all duration-300 bg-opacity-40 px-4 py-2 text-center text-white absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 invisible">
      <p class="text-2xl font-semibold">Thank you for playing!</p>

      <p class="mt-4">View the other submissions at</p>
      <a href="https://manor.hackclub.com" class="font-medium">manor.hackclub.com</a>
    </div>


    <!-- <div id="flashlight" class="absolute top-0 left-0 w-full h-full pointer-events-none transition-all duration-[1.5s]" style="--x: 0px; --y: 0px;">
    </div> -->
    <div id="flashlight" class=""></div>

    <!-- exit modal -->
    <div
      class="absolute shadow-lg top-1/2 left-1/2 w-[500px] -translate-x-1/2 -translate-y-1/2 bg-black border-4 border-white text-white rounded-lg p-6 flex flex-col items-center invisible"
      id="exit-modal">
      <p class="font-semibold text-2xl text-center mb-8">It seems like the door needs a 3-digit code...</p>

      <div class="flex justify-center space-x-4">
        <input type="text" maxlength="1" name="number1" id="number1"
          class="w-20 h-20 bg-black border border-white text-5xl text-center rounded-md focus:outline-none focus:ring-2 focus:ring-white"
          oninput="moveToNext(this, 'number2')">
        <input type="text" maxlength="1" name="number2" id="number2"
          class="w-20 h-20 bg-black border border-white text-5xl text-center rounded-md focus:outline-none focus:ring-2 focus:ring-white"
          oninput="moveToNext(this, 'number3')">
        <input type="text" maxlength="1" name="number3" id="number3"
          class="w-20 h-20 bg-black border border-white text-5xl text-center rounded-md focus:outline-none focus:ring-2 focus:ring-white">
      </div>

      <div>
        <button type="submit"
          class="mt-8 px-4 py-1 border-[2px] border-white rounded-md hover:bg-white hover:text-black font-semibold"
          onclick="validateAnswer()">Submit</button>

        <button class="ml-2 hover:underline"
          onclick="document.getElementById('exit-modal').classList.add('invisible')">Close</button>
      </div>

    </div>

  </div>


</body>

<script>
  function validateAnswer() {
    var val1 = document.getElementById('number1').value
    var val2 = document.getElementById('number2').value
    var val3 = document.getElementById('number3').value

    if (val1 === '7' && val2 === '3' && val3 === '4') {
      var correctAudio = new Audio('./assets/audio/leave.mp3')
      correctAudio.play()

      document.getElementById('exit-modal').classList.add('invisible')

      document.getElementById('puzzle3-radio').remove()
      document.getElementById('jumpscares-ghoul').remove()
      document.getElementById('puzzle2-trigger').remove()

      setTimeout(() => {
        document.getElementById('flashlight').classList.add('opacity-0')

        document.getElementById('thank-you').classList.remove('invisible')
      }, 2500)
    } else {
      var wrongAudio = new Audio('./assets/audio/wrong.mp3')
      wrongAudio.play()
    }

  }

  function moveToNext(current, nextFieldId) {
    if (current.value.length >= current.maxLength) {
      document.getElementById(nextFieldId).focus();
    }
  }

  // flashlight effect
  const flashlight = document.getElementById('flashlight');
  const gameContainer = document.getElementById('gameContainer');

  gameContainer.addEventListener('mousemove', (e) => {
    const rect = gameContainer.getBoundingClientRect();
    const x = e.clientX - rect.left;  // Adjust relative to the container
    const y = e.clientY - rect.top;   // Adjust relative to the container

    flashlight.style.setProperty('--x', x + 'px');
    flashlight.style.setProperty('--y', y + 'px');
  });

  // inventory

  const inventory = document.getElementById('inventory')
  function addToInventory(item) {
    const node = document.createElement('div')
    node.id = `inventoryItem-${item}`
    node.innerText = item
    node.className = 'text-5xl'

    inventory.appendChild(node)
  }

  // triggers

  function showNumber(where, num) {
    const wrapper = document.createElement('div')

    wrapper.id = `number-${num}`
    wrapper.className = 'absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[100] flex flex-col gap-6 items-center'

    wrapper.innerHTML = `
    <p class='px-2 py-1 font-semibold border-4 rounded-md bg-black text-white'>In the ${where}, there was a scrap of paper:  
    
    <div>
        <img src='./assets/scrap${num}.png' class='w-[270px]' />
      </div>

      <button class='px-2 py-1 font-semibold border-4 rounded-md bg-black text-white' onclick="document.getElementById('number-${num}').remove()">Okay</button>
    `

    gameContainer.appendChild(wrapper)

    if (num === 1) {
      setTimeout(() => {
        var scream = new Audio('./assets/audio/scream.mp3')
        scream.play()
      }, 5000)
    }
  }

  // jumpscares
  const skullTrigger = document.getElementById('jumpscares-skull');
  const skullImage = skullTrigger.querySelector('img'); // Get the skull image

  skullTrigger.addEventListener('click', () => {
    // audio
    var bonesAudio = new Audio('./assets/audio/bones.mp3')
    bonesAudio.play()

    // Create a clone of the skull image to apply the jumpscare effect
    const jumpscareImage = skullImage.cloneNode();
    jumpscareImage.classList.add('jumpscare');
    document.body.appendChild(jumpscareImage);

    // Wait for the next frame to ensure the image is in the DOM
    requestAnimationFrame(() => {
      jumpscareImage.style.opacity = '1'; // Make it visible
      jumpscareImage.style.transform = 'translate(-50%, -50%) scale(1.5)'; // Scale and center

      // After the animation ends, remove the element
      setTimeout(() => {
        document.body.removeChild(jumpscareImage);
      }, 1000); // Match the duration of the transition
    });

    skullTrigger.remove()
  });


  // puzzle 1
  const puzzle1Paper = document.getElementById('puzzle1-paper')
  const paperImage = puzzle1Paper.querySelector('img')
  puzzle1Paper.addEventListener('click', () => {
    var audio = new Audio('./assets/audio/paper-open.mp3')
    audio.play()

    puzzle1Paper.classList.add('invisible')
    document.getElementById('puzzle1-modal').classList.remove('invisible')
  })

  const handlePuzzle1Submit = () => {
    const answer = document.getElementById('puzzle1-input').value

    if (answer !== '419') {
      // wrong
      return
    }

    var key = new Audio('./assets/audio/key.mp3')
    key.play()

    document.getElementById('puzzle1-modal').classList.add('invisible')
    addToInventory('ðŸ”‘')
  }

  const handleLockClick = () => {
    const keyItem = inventory.querySelector('#inventoryItem-ðŸ”‘')

    // key rustling sound

    if (!keyItem) {
      // seems like you need a key...
      var chains = new Audio('./assets/audio/chains.mp3')
      chains.play()

      return
    }

    var unlock = new Audio('./assets/audio/unlock.mp3')
    unlock.play()

    keyItem.remove()

    setTimeout(() => {
      const lock = document.getElementById('puzzle1-padlock')
      lock.remove()
      showNumber('cabinet', 1)

      // move onto clue 2
      document.getElementById('jumpscares-ghoul').classList.remove('invisible')
      document.getElementById('puzzle2-trigger').classList.remove('invisible')
    }, 2500)
  }


  // puzzle 2



  const canvas = document.getElementById('console-canvas')
  const glitchDiv = document.getElementById('puzzle2-glitch')

  function checkConsolePos(e) {
    if (!glitchDiv.classList.contains('invisible')) return

    var rect = canvas.getBoundingClientRect();
    var x = e.clientX - rect.left;
    var y = e.clientY - rect.top;

    var pixel = context.getImageData(x, y, 1, 1).data;

    // red - move mouse back to start, glitch effect
    if (pixel[0] >= 220 && pixel[1] <= 20 && pixel[2] <= 20) {
      glitchDiv.classList.remove('invisible')

      var glitchAudio = new Audio('./assets/audio/glitch.mp3')
      glitchAudio.play()


      glitchDiv.onmouseleave = () => {
        glitchDiv.classList.add('invisible')
        glitchAudio.pause()
      }
    }

    if (pixel[0] === 0 && pixel[1] === 255 && pixel[2] === 0) {
      document.getElementById('puzzle2-success').classList.remove('invisible')

      var matrixAudio = new Audio('./assets/audio/matrix.mp3')
      matrixAudio.play()
    }
  }

  var context = canvas.getContext('2d');
  var img = new Image();

  img.onload = function () {
    context.drawImage(img, 0, 0, 704, 371);
  };
  img.src = '/assets/console.png';

  canvas.addEventListener('mousemove', (e) => checkConsolePos(e));


  // puzzle 3
  const radio = document.getElementById('puzzle3-radio')

  radio.addEventListener('click', () => {
    if (document.getElementById('puzzle2-success').classList.contains('invisible')) {
      var static = new Audio('./assets/audio/radio-static.mp3')
      static.play()
    } else {
      var static = new Audio('./assets/audio/clue3.wav')
      static.play()
    }
  })

</script>

</html>